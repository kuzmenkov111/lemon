---
title: "Capping axis lines"
author: "Stefan McKinnon Edwards <sme@iysik.com>"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    fig_caption: yes
vignette: >
  %\VignetteIndexEntry{Capping axis lines}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup,include=FALSE}
library(knitr)

knitr::opts_chunk$set(fig.height=4, fig.width=6)
```

## Demonstration

A quick demonstration of capping the lines.

First, load the package, generate a dataset and display it.

```{r load_pkg_and_data,fig.cap='Default ggplot2 plotting.'}
library(ggplot2)
library(splot)

dat1 <- data.frame(
  gp = factor(rep(letters[1:3], each = 10)),
  y = rnorm(30),
  cl = sample.int(3, 30, replace=TRUE),
  cl2 = sample(c('a','b','c'), 30, replace=TRUE)
)

my.theme <- theme_light()

(
  p <- ggplot(dat1, aes(gp, y)) + geom_point() + my.theme
)
```

**NB:** In order to manipulate the axis lines, they must be drawn.
Modify the theme so the `panel.border` is not drawn (it will be on top of the axis lines),
and have the axis lines drawn:

```{r theme}
my.theme <- my.theme + theme(panel.border=element_blank(), axis.line = element_line())
p <- p + my.theme
```

Now, let's have some fun.

We cap the bottom axis line to the right-most tick. The left end is also capped by the amount
specified with the `gap` argument (at time of writing, defaulted at `0.01`).
```{r fig.cap='Using `coord_capped_cart` to cap the bottom axis from the right. The left axis is unaffected.'}
p + coord_capped_cart(bottom='right')
```

To keep the axis lines consistent, we also specify the `left` argument, which still caps the left
axis line by the amount specified with the `gap` argument.
```{r fig.cap='As before, but left axis is now also capped to give a consistent look.'}
p + coord_capped_cart(bottom='right', left='none')
```


To avoid overplotting, we can apply a jitter. 
To emphasise that the x-axis is categorical, we can place brackets.
We finally polish the plot by removing the redundant vertical grid lines.
```{r fig.cap='Placing brackets brackets instead of ticks emphasises that the x-scale is categorical and not nominal.'}
ggplot(dat1, aes(gp, y)) + geom_point(position=position_jitter(width=0.2, height=0)) +
  coord_capped_cart(left='none', bottom=brackets_horisontal()) +
  my.theme + theme(panel.grid.major.x = element_blank())
```


## The `coord` objects



## Facets

Having produced such wonderous axes, it is a pity they are not plotted around 
all panels when using faceting. 

```{r}
dsamp <- diamonds[sample(nrow(diamonds), 1000), ]
(d <- ggplot(dsamp, aes(carat, price)) +
  geom_point(aes(colour = clarity)) + 
  coord_capped_cart(bottom='none', left='bottom') +
  facet_grid(.~cut) + my.theme
)
```

`facet_grid` and `facet_wrap` have been implemented in versions that display
the axis lines (and labels) on all panels. They work exactly like ggplot2's 
functions, and are named with `_rep_`:
```{r}
d + facet_rep_grid(.~cut)
```

If we want the labels shown as well, use the argument:
```{r}
d + facet_rep_grid(.~cut, repeat.tick.labels = TRUE)
```

It also works for `facet_wrap`:
```{r}
(d2 <- d + facet_rep_wrap(~cut, ncol=2))
```

Finally, the legend can be repositioned to fit in a panel by using 
`reposition_legend`.
See the vignette `legend`. 
The addition of `theme(legend.background)` is merely to provide a border around
the legend.
```{r}
d2 <- d2 + guides(colour=guide_legend(ncol=2)) + 
  theme(legend.background = element_rect(colour='grey'))
reposition_legend(d2, position='center', panel='panel-2-3')
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
